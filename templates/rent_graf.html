{% extends 'layout.html' %}

{% block content %}
    <form id="myForm" method="post">
        <h1>Rentabilidad y Gráficos FFMM</h1>
        <div class="form-container">
            <table>
                <tr>
                    <td>
                        <label for="datepicker">Seleccionar Fecha:</label>
                    </td>
                    <td> 
                        <input type="text" id="datepicker" name="datepicker" value="{{ fecha }}">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="run">Seleccionar RUT:</label>
                    </td>
                    <td style="margin-right: 10px;">
                        <select id="run" name="run">
                            {% for rut in runs %}
                                <option value="{{ rut }}">{{ rut }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="tipoGrafico">Seleccionar tipo de gráfico:</label>
                    </td>
                    <td> 
                        <select id="tipoGrafico" name="tipoGrafico" onchange="cambiarTipoGrafico()">
                            <option value="barras">Barras</option>
                            <option value="lineas">Líneas</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <button class="boton" onclick="submitForm()">Consultar</button>
                    </td>
                </tr>
            </table>
            <!-- Aquí agregamos un contenedor para el gráfico -->
            <div id="grafico-container">
                {{ grafico_html|safe }}
            </div>
        </div>
    </form>

    <script>
        function submitForm() {
            var form = document.getElementById('myForm');
            form.action = '/rentabilidades-graficos';
            form.submit();
        }

        $(document).ready(function() {
            $("#datepicker").datepicker({
                altFormat: 'yy-mm-dd',
                defaultDate: new Date('{{ fecha }}')
            });
        });
    </script>

    <script>
        function cambiarTipoGrafico() {
            // Obtén el contenedor del gráfico
            var graficoContainer = document.getElementById('grafico-container');
        
            // Obtén el valor seleccionado del tipo de gráfico
            var nuevoTipo = document.getElementById('tipoGrafico').value;
        
            // Recarga el gráfico con el nuevo tipo
            var graficoHTML = (nuevoTipo === 'barras') ? '{{ grafico_html }}' : '{{ grafico_lineas_html }}';
            graficoContainer.innerHTML = graficoHTML;
        }
    </script>

{% endblock %}
